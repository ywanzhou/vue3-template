# åŠ¨æ€æƒé™è·¯ç”±

## ç›®å½•

*   [ğŸ‡ å†™åœ¨å‰é¢](#-å†™åœ¨å‰é¢)

*   [ğŸˆ å®ç°æ€è·¯](#-å®ç°æ€è·¯)

*   [ğŸ‰ æ•°æ®åº“è®¾è®¡](#-æ•°æ®åº“è®¾è®¡)

*   [ğŸŠ mockæ•°æ®](#-mockæ•°æ®)

    *   [ğŸ‹ è¯·æ±‚æ•°æ®](#-è¯·æ±‚æ•°æ®)

*   [ğŸ ä½¿ç”¨piniaä¿å­˜æ•°æ®](#-ä½¿ç”¨piniaä¿å­˜æ•°æ®)

*   [ğŸŒ åŠ¨æ€è·¯ç”±å®ç°](#-åŠ¨æ€è·¯ç”±å®ç°)

    *   [ğŸ¥­ å®ç°åŠ¨æ€èœå•](#-å®ç°åŠ¨æ€èœå•)

    *   [ğŸ ä½¿ç”¨plopç”ŸæˆåŒç±»å‹çš„æ–‡ä»¶](#-ä½¿ç”¨plopç”ŸæˆåŒç±»å‹çš„æ–‡ä»¶)

    *   [ğŸ‘ åŠ¨æ€æ·»åŠ è·¯ç”±](#-åŠ¨æ€æ·»åŠ è·¯ç”±)

*   [ğŸ’ çœ‹ä¸€ä¸‹æ•ˆæœ](#-çœ‹ä¸€ä¸‹æ•ˆæœ)

*   [å†™åœ¨æœ€å](#å†™åœ¨æœ€å)

## ğŸ‡ å†™åœ¨å‰é¢

ä»»ä½•ä¸€ä¸ªç®¡ç†ç³»ç»Ÿ**å‡ ä¹éƒ½å­˜åœ¨**æƒé™ç®¡ç†å’ŒåŠ¨æ€è·¯ç”±ï¼Œå®ƒä¸€èˆ¬å’Œç”¨æˆ·ç®¡ç†ä¸€åŒå‡ºç°ï¼Œå¯èƒ½æœ‰çš„äººè§‰å¾—è¿™ä¸ªä¸œè¥¿æ¯ä¸ªç®¡ç†ç³»ç»Ÿéƒ½å­˜åœ¨ï¼Œè§‰å¾—è¿™ä¸ªæ¨¡å—æ²¡æœ‰è¿™ä¹ˆçš„é‡è¦ï¼›è€Œåœ¨æˆ‘çš„è®¤çŸ¥é‡Œï¼Œåƒ**æƒé™æ§åˆ¶å’Œç”¨æˆ·ç®¡ç†æ˜¯ç®¡ç†ç³»ç»Ÿä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†**ï¼Œå®ƒæ˜¯æ•´ä¸ªç®¡ç†ç³»ç»Ÿä¸­æœ€åŸºç¡€çš„éƒ¨åˆ†ï¼Œåªæœ‰è¿™éƒ¨åˆ†å®Œå–„äº†ï¼Œå…¶ä»–æ¨¡å—æ‰å¯ä»¥éå¸¸é¡ºåˆ©çš„è¿›è¡Œå¼€å‘ã€‚

æœ¬ç¯‡æ–‡ç« é€šè¿‡æ–‡å­—+å›¾ç‰‡+åŠ¨å›¾æ¼”ç¤ºçš„å½¢å¼ä»‹ç»äº†ä¸€ä¸ªæœ€åŸºæœ¬çš„**åŠ¨æ€æƒé™è·¯ç”±**å®ç°æ€è·¯ä»¥åŠå®ç°è¿‡ç¨‹ï¼Œé˜…è¯»è¿™ç¯‡æ–‡ç« ä½ å¯èƒ½ä¼šæ”¶è·ï¼š

1.  ç”¨æˆ·ç®¡ç†éƒ¨åˆ†çš„E-Rå›¾ï¼›

2.  é€šè¿‡`plop`è„šæ‰‹æ¶å¿«é€Ÿåˆ›å»ºåŒç±»å‹æ–‡ä»¶ï¼›

3.  `pinia`å¦‚ä½•ä½¿ç”¨ï¼›

4.  å¦‚ä½•ä½¿ç”¨`mock`ï¼›

5.  å¦‚ä½•**ç¼–å†™åŠ¨æ€æƒé™è·¯ç”±**ï¼›

> PSï¼šæ•°æ®æ¥æºäºmockã€å‰ç«¯æ¡†æ¶æ˜¯Vue3ã€çŠ¶æ€ç®¡ç†æ˜¯Piniaã€UIæ¡†æ¶æ˜¯ElementPlusã€‚

## ğŸˆ å®ç°æ€è·¯

ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘è¿™é‡Œç”»äº†ä¸€å¼ å›¾ï¼Œå¦‚ä¸‹ï¼š

![](image/å®ç°æ­¥éª¤_rx5_LL7f7A.png)

ç°åœ¨æˆ‘ä»¬æ¥è¯¦ç»†è®²è§£ä¸€ä¸‹æ€è·¯ï¼š

1.  ç”¨æˆ·ç™»å½•è·å–ç”¨æˆ·idæˆ–è€…tokenï¼›

2.  æ ¹æ®tokenæˆ–è€…ç”¨æˆ·idå»è·å–ç”¨æˆ·å¯¹åº”çš„æƒé™ï¼›

3.  è·å–åˆ°ç”¨æˆ·æƒé™åè¿›è¡Œç¼“å­˜ï¼Œå¹¶å­˜å‚¨åˆ°`pinia`ä¸­ï¼›

4.  æ ¹æ®è·å–çš„ç”¨æˆ·æƒé™ç”Ÿæˆå¯¹åº”çš„èœå•ï¼›

5.  æ ¹æ®ç¼–å†™å¥½çš„routeç»“åˆç”¨æˆ·æƒé™ç”Ÿæˆå¯¹åº”çš„routerï¼Œå¹¶é€šè¿‡addRouteæ·»åŠ åˆ°è·¯ç”±å®ä¾‹ä¸­ã€‚

## ğŸ‰ æ•°æ®åº“è®¾è®¡

æƒ³è¦å®ç°åŠ¨æ€è·¯ç”±ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯é€šè¿‡åç«¯é…åˆå®ç°ï¼Œè¿™é‡Œè®²è§£ä¸€ä¸‹æ•°æ®åº“å¦‚ä½•è®¾è®¡ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹E-Rå›¾ï¼š

![](image/åŠ¨æ€è·¯ç”±ERå›¾_6r_u3_r0Ae.png)

è¿™é‡Œæ˜¯æœ€ç®€å•çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œä½ å¯ä»¥æ ¹æ®è¿™ä¸ªE-Rå›¾è¿›è¡Œæ‰©å±•ã€‚

æ ¹æ®E-Rå›¾å¯ä»¥å¾—çŸ¥çš„æ•°æ®åº“è¡¨å¦‚ä¸‹ï¼š

*   ç”¨æˆ·è¡¨

*   è§’è‰²è¡¨

*   æƒé™è¡¨

*   è§’è‰²æƒé™è¡¨

å…¶ä¸­ï¼Œè§’è‰²æ¡ä»¶è¡¨ä¸­çš„åœ°å€ï¼Œå¯¹åº”`Route`ä¸­çš„`path`é€‰é¡¹ï¼ˆä½ ä¹Ÿå¯ä»¥æ¢ä¸€ä¸ªå­—æ®µï¼Œæ€»ä¹‹å°±æ˜¯**éœ€è¦æƒé™è¡¨ä¸­å­˜åœ¨ä¸€ä¸ªå­—æ®µä¸**\*\*\*\***ä¸­ç›¸å¯¹åº”**ï¼‰ã€‚

**æˆ‘ä»¬è¿˜å¯ä»¥å°†è·¯ç”±çš„**\*\*****é…ç½®åœ¨æƒé™è¡¨ä¸­ï¼Œæ¯”å¦‚****\*\*\*\*ã€\*\*\*\*\*\***ç­‰ä¿¡æ¯ã€‚**

ç”¨æˆ·å’Œè§’è‰²æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªç”¨æˆ·åªæœ‰ä¸€ä¸ªè§’è‰²ï¼Œä¹Ÿå¯ä»¥æ ¹æ®ä½ çš„ç³»ç»Ÿè¿›è¡Œè°ƒæ•´ä¸ºå¤šå¯¹å¤šï¼Œæ— éå°±æ˜¯å¢åŠ ä¸€ä¸ªä¸­é—´è¡¨è€Œå·²ã€‚

## ğŸŠ mockæ•°æ®

å¦‚æœä½ æœ‰åç«¯çš„è¯ï¼Œè¿™ä¸€æ­¥å°±å¯ä»¥ç›´æ¥è·³è¿‡äº†ï¼Œè¿™é‡Œæˆ‘ä¸ºäº†æ¼”ç¤ºæ¨¡æ‹Ÿäº†ä¸€äº›æ•°æ®ã€‚

é¦–å…ˆå®‰è£…ä¾èµ–

```bash
npm i vite-plugin-mock
```

ç¬¬äºŒæ­¥åœ¨`vite.config.ts`ä¸­åªç”¨è¿™ä¸ªæ’ä»¶ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```typescript
import { viteMockServe } from 'vite-plugin-mock'

export default defineConfig(({ mode }: ConfigEnv) => {
  return {
    plugins: [
      // é…ç½®mock
      viteMockServe({
        mockPath: '/mock',
        localEnabled: true,
      }),
    ],
  }
})

```

ç„¶åè‡ªå·±é€ ä¸€äº›å‡æ•°æ®ï¼Œå¯ä»¥å‚è€ƒ[æˆ‘æ¨¡æ‹Ÿçš„æ•°æ®](https://github.com/ywanzhou/vue3-template/blob/master/mock/data.ts "æˆ‘æ¨¡æ‹Ÿçš„æ•°æ®")ï¼Œç„¶åç¼–å†™ä¸€äº›å‡çš„æ¥å£ï¼Œå¦‚ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•ç¼–å†™ä¸€ä¸ªæ¥å£ï¼š

```typescript
const mockList: MockMethod[] = [
  {
    url: '/mock/login',
    method: 'post', // è¯·æ±‚æ–¹å¼
    statusCode: 200, // è¿”å›çš„httpçŠ¶æ€ç 
    response: opt => { // opt å¯¹è±¡ä¸­åŒ…å« url  body  query  headers
      return {
        // è¿”å›çš„ç»“æœé›†
        statusCode: 200,
        desc: 'ç™»å½•æˆåŠŸ',
        result: {
          name: 'ä¸€ç¢—å‘¨',
        },
      }
    },
  },
]
export default mockList
```

æˆ‘ä¼ªé€ çš„æ¥å£å¯ä»¥å‚è€ƒ[GitHub](https://github.com/ywanzhou/vue3-template/blob/master/mock/index.ts "GitHub")ã€‚

### ğŸ‹ è¯·æ±‚æ•°æ®

è¯·æ±‚æ•°æ®æˆ‘ä½¿ç”¨ä¹‹å‰[å°è£…](https://juejin.cn/post/7071518211392405541 "å°è£…")[axios](https://juejin.cn/post/7071518211392405541 "axios")ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```typescript
import request from '/@/service'
import type {
  IPermissionList,
  IRoleList,
  IUserDetail,
  IUserList,
} from './types/mock'
/* more request */
export const getUserDetail = (data: { id: any }) => {
  return request<any, IUserDetail>({
    url: '/mock/getUserDetail',
    method: 'get',
    data,
  })
}

```

## ğŸ ä½¿ç”¨piniaä¿å­˜æ•°æ®

æˆ‘åœ¨è¿™é‡Œå°±ä¸å¤šè¯´piniaæ˜¯ä»€ä¹ˆäº†ï¼Œç®€è€Œè¨€ä¹‹è¿™ä¸ªğŸå°±æ˜¯Vuex5ï¼ŒåŸºæœ¬ä½¿ç”¨å¯ä»¥å‚è€ƒ[è¿™é‡Œ](https://juejin.cn/post/7074885076823048223#heading-21 "è¿™é‡Œ")ã€‚

å¦‚ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•åœ¨`pinia`ä¸­è·å–æ•°æ®ï¼š

```typescript
import { defineStore } from 'pinia'
// è·å–è·¯ç”±å®ä¾‹
import router from '/@/router'
import {
  getPermissionList,
  getRoleList,
  getUserDetail,
  getUserList,
} from '/@/api/mock'
import type { IUser } from './types'

export const useUserStore = defineStore({
  id: 'user', // idå¿…å¡«ï¼Œä¸”éœ€è¦å”¯ä¸€
  // state
  state: (): IUser => {
    return {
      permissionList: [],
      roleList: [],
      userList: [],
      userDetail: undefined,
    }
  },
  // getters
  getters: {
    menuList: state => {
      return state.userDetail?.permissionList
    },
  },
  // actions
  actions: {
    async getData() {
      this.userList = (await getUserList()).result
      this.permissionList = (await getPermissionList()).result
      this.roleList = (await getRoleList()).result
      this.userDetail = (await getUserDetail({ id: this.curId })).result
      // TODO åŠ¨æ€æ·»åŠ è·¯ç”±
    },
  },
})

```

å¯ä»¥æ ¹æ®éœ€è¦å†³å®šæ˜¯å¦è¿›è¡Œæ•°æ®çš„ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ä¸‹æ¬¡å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å–ï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼š

![](image/æ‰§è¡Œæµç¨‹1_PrOTTiqkxF.png)

## ğŸŒ åŠ¨æ€è·¯ç”±å®ç°

### ğŸ¥­ å®ç°åŠ¨æ€èœå•

æˆ‘åœ¨`getUserDetail`æ¥å£ä¸­è¿”å›äº†è¯¥ç”¨æˆ·çš„èœå•ï¼Œå®ƒçš„ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼š

```typescript
export interface IPermissionList {
  id: number
  // èœå•åç§°
  name: string
  // èœå•ç±»å‹ 1è¡¨ç¤ºä¸€çº§èœå•ã€2è¡¨ç¤ºäºŒçº§èœå•
  type: number
  // çˆ¶çº§
  pid?: number
  // åœ°å€æ çš„è·¯å¾„ï¼Œä¸routeä¸­çš„pathå¯¹åº”ï¼Œä»è€Œæ‰¾åˆ°ç»„ä»¶
  path: string
}
interface PermissionList extends IPermissionList {
  children: IPermissionList[]
}
export interface IUserDetail extends IUserList {
  // æƒé™åˆ—è¡¨
  permissionList: PermissionList[]
}
interface IUserRole {
  roleId: number
  name: string
}
export interface IUserList {
  id: number
  name: string
  role: IUserRole
  createTime: string
  updateTime: string
}

```

æˆ‘ä»¬åœ¨`pinia`ä¸­ç¼–å†™äº†ä¸€ä¸ª`getters`è·å–äº†èœå•çš„é…ç½®ï¼Œç›´æ¥ä½¿ç”¨å°±å¥½ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š

```vue
<script lang="ts" setup>
import { useUserStore } from '/@/store'
const activeIndex = computed(() => {
  return useRoute().path
})
const menuList = computed(() => {
  return useUserStore().menuList
})
</script>
<template>
  <el-menu
    :default-active="activeIndex"
    class="el-menu-demo"
    router
    mode="horizontal"
  >
    <template v-for="menu in menuList" :key="menu.id">
      <!-- æ²¡æœ‰å­è·¯ç”±çš„æƒ…å†µ -->
      <el-menu-item v-if="!menu.children" :index="'/main' + menu.path">
        <span>{{ menu.name }}</span>
      </el-menu-item>

      <!-- å­˜åœ¨å­è·¯ç”±çš„æƒ…å†µ -->
      <el-sub-menu v-else :index="'/main' + menu.path">
        <template #title>{{ menu.name }}</template>
        <el-menu-item
          v-for="_menu in menu.children"
          :key="_menu.id"
          :index="'/main' + _menu.path"
          >{{ _menu.name }}</el-menu-item
        >
      </el-sub-menu>
    </template>
  </el-menu>
</template>

```

æœ€ç»ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](image/è·¯ç”±å±•ç¤º_PIfCuP1Wzl.png)

### ğŸ ä½¿ç”¨plopç”ŸæˆåŒç±»å‹çš„æ–‡ä»¶

å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè·¯ç”±æ—¶ï¼Œéœ€è¦ç¼–å†™å¾ˆå¤šé‡å¤æ˜“é”™çš„ä»£ç ï¼Œä¸”è¿™äº›ä»£ç æ²¡æœ‰ä»»ä½•å«é‡ï¼Œé™¤äº†`path`å’Œä¸€äº›`meat`å±æ€§éƒ½æ˜¯ä¸€æ ·çš„ã€‚

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨`plop`è¿™æ¬¾è„šæ‰‹æ¶æ¥åˆ›å»ºåŒç±»å‹çš„æ–‡ä»¶ï¼Œè¿™ä¸ªè„šæ‰‹æ¶ä½¿ç”¨ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

é¦–å…ˆæˆ‘ä»¬å°†Plopä½œä¸ºä¸€ä¸ªnpmæ¨¡å—è¿›è¡Œå®‰è£…ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š

```powershell
npm i plop --dev
```

ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºé¡¹ç›®çš„æ ¹ç›®å½•åˆ›å»ºå…¥å£æ–‡ä»¶ï¼Œæ–‡ä»¶åä¸º`plopfile.js`ï¼Œç„¶åå†™å…¥å¦‚ä¸‹ä»£ç ï¼š

```javascript
// Plopå·¥ä½œçš„å…¥å£æ–‡ä»¶ï¼Œéœ€è¦å¯¼å‡ºä¸€ä¸ªå‡½æ•°
// æ­¤å‡½æ•°æ¥æ”¶ä¸€ä¸ª plop å¯¹è±¡ï¼Œç”¨äºåˆ›å»ºç”Ÿæˆå™¨ä»»åŠ¡
export default function (plop) {
    // setGeneratoræ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºç”Ÿæˆå™¨çš„åå­—ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”Ÿæˆå™¨çš„ä¸€äº›é…ç½®é€‰é¡¹
    plop.setGenerator('main', {
    description: 'åˆ›å»ºæ–°çš„è·¯ç”±ä»¥åŠç»„ä»¶',
    // åœ¨å‘½ä»¤è¡Œçœ‹åˆ°äº¤äº’ä¿¡æ¯
    prompts: [
      {
        type: 'input',
        name: 'pathName',
        message: 'component path:',
      },
      {
        type: 'input',
        name: 'urlName',
        message: 'url:',
      },
      {
        type: 'input',
        name: 'componentName',
        message: 'component name:',
      },
    ],
    // åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œçš„åŠ¨ä½œï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡è¡¨ç¤ºä¸€ä¸ªä»»åŠ¡
    actions: [
      {
        // type ä¸º add è¡¨ç¤ºæ·»åŠ æ–‡ä»¶
        type: 'add',
        path: 'src/views/main/{{pathName}}/{{componentName}}.vue',
        templateFile: 'plop-templates/main/vue.hbs',
      },
      {
        type: 'add',
        path: 'src/router/main/{{urlName}}/index.ts',
        // æŒ‡å®šæ¨¡æ¿æ–‡ä»¶
        templateFile: 'plop-templates/main/router.hbs',
      },
    ],
  })
}


```

Plopä¸­ä½¿ç”¨æ˜¯[Handlebars](https://handlebarsjs.com/ "Handlebars")æ¨¡æ¿å¼•æ“ï¼Œæ‰€ä»¥æ”¯æŒæ’æ§½çš„æ¨¡å¼ã€‚`pathName`è¡¨ç¤ºæˆ‘ä»¬ä¸Šé¢è¾“å…¥çš„é‚£ä¸ª`name`ã€‚

ç„¶åå°±æ˜¯åˆ›å»ºæˆ‘ä»¬çš„æ¨¡æ¿æ–‡ä»¶ï¼Œé€šå¸¸åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º`plop-templates`æ–‡ä»¶å¤¹ï¼Œç„¶åå†™å…¥ç›¸åº”çš„æ¨¡æ¿æ–‡ä»¶ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

`vue.hbs`

```hbs
<script setup lang="ts"></script>

<template>
  <div>{{ componentName }}</div>
</template>

<style scoped></style>


```

`router.hbs`

```html
const router = { name: '{{componentName}}', path: '/main/{{pathName}}/{{urlName}}',
component: () => import('/@/views/main/{{pathName}}/{{componentName}}.vue'), }
export default router

```

æœ€ååœ¨å‘½ä»¤è¡Œä¸­é”®å…¥å¦‚ä¸‹å‘½ä»¤ä½¿ç”¨

```powershell
npx plop main
```

åˆ›å»ºè¿‡ç¨‹å¦‚ä¸‹ï¼š

![](<image/plop test demo_rRziRLXVST.gif>)

æˆ‘è¿™é‡Œä»…ä»…æ˜¯åšäº†æœ€åŸºç¡€çš„é…ç½®ï¼Œä½ ä¹Ÿå¯ä»¥é…ç½®`meta`å±æ€§ï¼Œæ€»ä¹‹`plop`çš„åŠŸèƒ½è¿˜æ˜¯å¾ˆå¼ºå¤§çš„ã€‚

### ğŸ‘ åŠ¨æ€æ·»åŠ è·¯ç”±

é¦–å…ˆæˆ‘ä»¬é€šè¿‡`import.meta.glob()`å‡½æ•°è·å–æŒ‡å®šç›®å½•ä¸‹çš„æ¨¡å—ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```typescript
// è·å–æ‰€æœ‰è·¯ç”±é…ç½®æ–‡ä»¶çš„å‡½æ•°
const getMainRouteFileList = async () => {
  const allRoutes: RouteRecordRaw[] = []
  // import.meta.glob æ‰¹é‡å¯¼å…¥æ–‡ä»¶
  const routeFileList = import.meta.glob('../router/main/**')
  for (const path in routeFileList) {
    const mod = await routeFileList[path]()
    allRoutes.push(mod.default)
  }
  return allRoutes
}
```

ç„¶åæˆ‘ä»¬æ ¹æ®`menuList`åŠ¨æ€ç”Ÿæˆè·¯ç”±é…ç½®æ–‡ä»¶ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```typescript
// src\utils\router.ts
// å¤„ç†åŠ¨æ€è·¯ç”±
/**
 * 1. è·å–æ‰€æœ‰è·¯ç”±é…ç½®æ–‡ä»¶
 * 2. æ ¹æ® menuList åŠ¨æ€ç”Ÿæˆ Route
 */
import type { RouteRecordRaw } from 'vue-router'
// é€’å½’è·å–Route
const recurseGetRoute = (menus: any[], allRoutes: any[], route: any[]) => {
  // éå†ä¼ é€’çš„èœå•
  for (const menu of menus) {
    // å¦‚æœæ²¡æœ‰childrenå±æ€§ï¼Œåˆ™å°†è¯¥é¡¹ç›´æ¥pushåˆ°routeä¸­
    if (!menu.children) {
      // æ‰¾åˆ°å¯¹åº”çš„è·¯ç”±é…ç½®æ–‡ä»¶
      const r = allRoutes.find(
        (route: any) => route.path === '/main' + menu.path,
      )
      // å¦‚æœæ‰¾åˆ°åŒ¹é…çš„åˆ™è¿›è¡Œæ·»åŠ 
      r && route.push(r)
    } else {
      recurseGetRoute(menu.children, allRoutes, route)
    }
  }
}
// æ ¹æ®èœå•ç”Ÿæˆè·¯ç”±
export const menuToRoutes = (userMenu: any[]): Promise<RouteRecordRaw[]> => {
  return new Promise(resolve => {
    const routes: RouteRecordRaw[] = []

    getMainRouteFileList().then(res => {
      // 1. è·å–æ‰€æœ‰çš„routes
      const allRoutes: RouteRecordRaw[] = res
      // 2. é…ç½®è¯¥æƒé™çš„routes
      recurseGetRoute(userMenu, allRoutes, routes)

      resolve(allRoutes)
    })
  })
}

```

ç°åœ¨æˆ‘ä»¬å°è£…çš„`menuToRoutes`æ–¹æ³•å°±å¯ä»¥è·å–å…¨éƒ¨çš„åŠ¨æ€è·¯ç”±ï¼Œ**åœ¨è·å–æ•°æ®åè¿›è¡ŒåŠ¨æ€çš„æ·»åŠ è·¯ç”±**å³å¯ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```typescript
actions: {
  async getData() {
    /* more request code */
    // åŠ¨æ€æ·»åŠ è·¯ç”±
    if (this.menuList) {
      const routes = await menuToRoutes(this.menuList)
      for (const route of routes) {
        router.addRoute('main', route)
      }
    }
  },
},
```

æœ€åï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ­¥ï¼Œåœ¨`main.ts`ä¸­è°ƒç”¨å‡½æ•°ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```typescript
import { createApp } from 'vue'
import App from './App.vue'
import router from './router'
import { useUserStore } from './store'
import store from './store'
const app = createApp(App).use(store)

// è·å–åŸºç¡€æ•°æ®
await useUserStore().getData()

app.use(router).mount('#app')

```

åˆ°æ­¤ä¸ºæ­¢æˆ‘ä»¬å°±å®ç°äº†è¿™ä¸ªç®€æ˜“çš„åŠ¨æ€æƒé™è·¯ç”±ã€‚

## ğŸ’ çœ‹ä¸€ä¸‹æ•ˆæœ

ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ•ˆæœï¼š

![](image/demo_5LrD8bqr2-.gif)

## å†™åœ¨æœ€å

æœ¬ç¯‡æ–‡ç« åˆ°è¿™ä¸ºæ­¢å°±ç»“æŸäº†ï¼Œå¦‚æœä½ æ„Ÿè§‰è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰ç”¨ï¼Œå¯ä»¥ç‚¹èµæ”¶è—æ”¯æŒä¸€ä¸‹ï¼ˆç‚¹èµçš„éƒ½è„±å•ã€æš´å¯Œï¼‰ï¼›ä¸Šé¢çš„ä»£ç å…¨éƒ¨éƒ½åœ¨[Github](https://github.com/ywanzhou/vue3-template "Github")ä¸­ï¼Œå¯ä»¥ç‚¹ä¸ªstaré¿å…è¿·è·¯ã€‚

*   å¦‚æœæ–‡ä¸­æœ‰é”™è¯¯æ¬¢è¿æŒ‡æ­£\~

*   å¦‚æœä½ æœ‰å»ºè®®æ¬¢è¿æå‡º\~
